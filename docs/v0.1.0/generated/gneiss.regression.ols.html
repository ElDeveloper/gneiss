<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gneiss.regression.ols &#8212; gneiss 0.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="gneiss 0.2 documentation" href="../index.html" />
    <link rel="up" title="Regression functions (gneiss.regression)" href="../regression.html" />
    <link rel="next" title="gneiss.regression.mixedlm" href="gneiss.regression.mixedlm.html" />
    <link rel="prev" title="Regression functions (gneiss.regression)" href="../regression.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="gneiss-regression-ols">
<h1>gneiss.regression.ols<a class="headerlink" href="#gneiss-regression-ols" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="gneiss.regression.ols">
<code class="descclassname">gneiss.regression.</code><code class="descname">ols</code><span class="sig-paren">(</span><em>formula</em>, <em>table</em>, <em>metadata</em>, <em>tree</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gneiss/regression/_regression.html#ols"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gneiss.regression.ols" title="Permalink to this definition">¶</a></dt>
<dd><p>Ordinary Least Squares applied to balances.</p>
<p>A ordinary least square regression is performed on nonzero relative
abundance data given a list of covariates, or explanatory variables
such as ph, treatment, etc to test for specific effects. The relative
abundance data is transformed into balances using the ILR transformation,
using a tree to specify the groupings of the features. The regression
is then performed on each balance separately. Only positive data will
be accepted, so if there are zeros present, consider using a zero
imputation method such as <code class="docutils literal"><span class="pre">multiplicative_replacement</span></code> or add a
pseudocount.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>formula</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Formula representing the statistical equation to be evaluated.
These strings are similar to how equations are handled in R and
statsmodels. Note that the dependent variable in this string should
not be specified, since this method will be run on each of the
individual balances. See <cite>patsy</cite> for more details.</li>
<li><strong>table</strong> (<em>pd.DataFrame</em>) &#8211; Contingency table where samples correspond to rows and
features correspond to columns.</li>
<li><strong>metadata</strong> (<em>pd.DataFrame</em>) &#8211; Metadata table that contains information about the samples contained
in the <cite>table</cite> object.  Samples correspond to rows and covariates
correspond to columns.</li>
<li><strong>tree</strong> (<em>skbio.TreeNode</em>) &#8211; Tree object where the leaves correspond to the columns contained in
the table.</li>
<li><strong>**kwargs</strong> (<a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; Other arguments accepted into <cite>statsmodels.regression.linear_model.OLS</cite></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Container object that holds information about the overall fit.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="gneiss.regression.RegressionResults.html#gneiss.regression.RegressionResults" title="gneiss.regression.RegressionResults">RegressionResults</a></p>
</td>
</tr>
</tbody>
</table>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">gneiss.regression</span> <span class="k">import</span> <span class="n">ols</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skbio</span> <span class="k">import</span> <span class="n">TreeNode</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
<p>Here, we will define a table of proportions with 3 features
<cite>a</cite>, <cite>b</cite>, and <cite>c</cite> across 5 samples.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">proportions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[[</span><span class="mf">0.720463</span><span class="p">,</span> <span class="mf">0.175157</span><span class="p">,</span> <span class="mf">0.104380</span><span class="p">],</span>
<span class="gp">... </span>     <span class="p">[</span><span class="mf">0.777794</span><span class="p">,</span> <span class="mf">0.189095</span><span class="p">,</span> <span class="mf">0.033111</span><span class="p">],</span>
<span class="gp">... </span>     <span class="p">[</span><span class="mf">0.796416</span><span class="p">,</span> <span class="mf">0.193622</span><span class="p">,</span> <span class="mf">0.009962</span><span class="p">],</span>
<span class="gp">... </span>     <span class="p">[</span><span class="mf">0.802058</span><span class="p">,</span> <span class="mf">0.194994</span><span class="p">,</span> <span class="mf">0.002948</span><span class="p">],</span>
<span class="gp">... </span>     <span class="p">[</span><span class="mf">0.803731</span><span class="p">,</span> <span class="mf">0.195401</span><span class="p">,</span> <span class="mf">0.000868</span><span class="p">]],</span>
<span class="gp">... </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="s1">&#39;s2&#39;</span><span class="p">,</span> <span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="s1">&#39;s4&#39;</span><span class="p">,</span> <span class="s1">&#39;s5&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Now we will define the environment variables that we want to
regress against the proportions.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env_vars</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<span class="gp">... </span>    <span class="s1">&#39;temp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">],</span>
<span class="gp">... </span>    <span class="s1">&#39;ph&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="s1">&#39;s2&#39;</span><span class="p">,</span> <span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="s1">&#39;s4&#39;</span><span class="p">,</span> <span class="s1">&#39;s5&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Finally, we need to define a bifurcating tree used to convert the
proportions to balances.  If the internal nodes aren&#8217;t labels,
a default labeling will be applied (i.e. <cite>y1</cite>, <cite>y2</cite>, ...)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tree</span> <span class="o">=</span> <span class="n">TreeNode</span><span class="o">.</span><span class="n">read</span><span class="p">([</span><span class="s1">&#39;(c, (b,a)Y2)Y1;&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Once these 3 variables are defined, a regression can be performed.
These proportions will be converted to balances according to the
tree specified.  And the regression formula is specified to run
<cite>temp</cite> and <cite>ph</cite> against the proportions in a single model.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="s1">&#39;temp + ph&#39;</span><span class="p">,</span> <span class="n">proportions</span><span class="p">,</span> <span class="n">env_vars</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
</pre></div>
</div>
<p>From the summary results of the <cite>ols</cite> function, we can view the
pvalues according to how well each individual balance fitted in the
regression model.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">pvalues</span>
<span class="go">       Intercept            ph      temp</span>
<span class="go">Y1  2.479592e-01  1.990984e-11  0.243161</span>
<span class="go">Y2  6.089193e-10  5.052733e-01  0.279805</span>
</pre></div>
</div>
<p>We can also view the balance coefficients estimated in the regression
model. These coefficients can also be viewed as proportions by passing
<cite>project=True</cite> as an argument in <cite>res.coefficients()</cite>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">coefficients</span><span class="p">()</span>
<span class="go">    Intercept            ph      temp</span>
<span class="go">Y1  -0.000499  9.999911e-01  0.000026</span>
<span class="go">Y2   1.000035  2.865312e-07 -0.000002</span>
</pre></div>
</div>
<p>The balance residuals from the model can be viewed as follows.  Again,
these residuals can be viewed as proportions by passing <cite>project=True</cite>
into <cite>res.residuals()</cite></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">residuals</span><span class="p">()</span>
<span class="go">              Y1            Y2</span>
<span class="go">s1 -4.121647e-06 -2.998793e-07</span>
<span class="go">s2  6.226749e-07 -1.602904e-09</span>
<span class="go">s3  1.111959e-05  9.028437e-07</span>
<span class="go">s4 -7.620619e-06 -6.013615e-07</span>
<span class="go">s5 -1.332268e-14 -2.375877e-14</span>
</pre></div>
</div>
<p>The predicted balances can be obtained as follows.  Note that the predicted
proportions can also be obtained by passing <cite>project=True</cite> into
<cite>res.predict()</cite></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="go">          Y1        Y2</span>
<span class="go">s1  1.000009  0.999999</span>
<span class="go">s2  2.000000  0.999999</span>
<span class="go">s3  2.999991  0.999999</span>
<span class="go">s4  3.999982  1.000000</span>
<span class="go">s5  4.999999  0.999998</span>
</pre></div>
</div>
<p>The overall model fit can be obtained as follows</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">r2</span>
<span class="go">0.99999999997996369</span>
</pre></div>
</div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><code class="xref py py-func docutils literal"><span class="pre">statsmodels.regression.linear_model.OLS()</span></code>, <code class="xref py py-func docutils literal"><span class="pre">skbio.stats.composition.multiplicative_replacement()</span></code></p>
</div>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../regression.html">Regression functions (<code class="docutils literal"><span class="pre">gneiss.regression</span></code>)</a><ul>
      <li>Previous: <a href="../regression.html" title="previous chapter">Regression functions (<code class="docutils literal"><span class="pre">gneiss.regression</span></code>)</a></li>
      <li>Next: <a href="gneiss.regression.mixedlm.html" title="next chapter">gneiss.regression.mixedlm</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/generated/gneiss.regression.ols.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, gneiss development team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.9</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../_sources/generated/gneiss.regression.ols.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>